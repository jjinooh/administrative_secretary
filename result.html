<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê²€ìƒ‰ê²°ê³¼ â€“ ë‚´ ì† ì•ˆì˜ í–‰ì •ë¹„ì„œ</title>
  <style>
    :root { --border:#dadce0; --bg:#fffcf0; }
    *{box-sizing:border-box; margin:0; padding:0;}
    body{ background:var(--bg); font-family:-apple-system, "Noto Sans KR", sans-serif; color:#202124; margin:0; }

    /* í—¤ë” */
    header{
      position:sticky; top:0; z-index:10;
      background:var(--bg); border-bottom:1px solid #eee;
    }
    .header-inner{
      max-width:1080px; margin:0 auto; padding:12px 16px;
      display:flex; align-items:center; gap:14px; flex-wrap:wrap;
    }
    .logos{display:flex; align-items:center; gap:10px;}
    .logos img{height:40px;}
    .mainlogo{height:48px; transition:height .18s ease;}
    .search-wrap{flex:1; display:flex; align-items:center; gap:10px;}
    .bar{
      flex:1; display:flex; align-items:center; gap:10px;
      padding:8px 14px; background:#fff;
      border:1px solid var(--border); border-radius:24px;
    }
    .bar input{
      flex:1; border:0; outline:0; font-size:15px; background:transparent;
    }
    .bar button{
      padding:8px 14px; border:2px solid #000;
      background:#fff; border-radius:6px; cursor:pointer; transition:.2s;
    }
    .bar button:hover{background:#000;color:#fff;}
    .actions{display:flex; gap:8px; flex-wrap:wrap;}
    .btn{ padding:8px 12px; border:2px solid #000; background:#fff; border-radius:6px; cursor:pointer; font-size:14px; transition:.2s; }
    .btn:hover{background:#000;color:#fff;}

    /* ë‚´ìš© */
    main{max-width:800px;margin:24px auto;padding:0 16px;}
    .result-box{
      background:#fff; border:1px solid #ddd;
      border-radius:12px; padding:18px; position:relative;
      min-height:160px;
    }
    .qline{font-size:14px;color:#5f6368;margin-bottom:8px;}
    .answer{white-space:pre-line;line-height:1.7; word-break:break-word;}

    /* ì‹œì—° ë²„íŠ¼ */
    .demo-buttons{ position:absolute; top:12px; right:12px; display:flex; gap:6px; }
    .demo-btn{ padding:5px 10px; font-size:13px; border:1px solid #000; background:#fff; border-radius:6px; cursor:pointer; transition:.2s; }
    .demo-btn:hover{background:#000;color:#fff;}

    /* ë¡œë”© ìƒíƒœ */
    .loading{ display:flex; align-items:center; gap:10px; padding:8px 0; }
    .loading img{ width:50px; height:50px; display:block; }
    .hidden{ display:none !important; }

    /* ìºë¦­í„° (indexì™€ ë™ì¼í•œ ê·œì¹™ ì‚¬ìš© ê°€ëŠ¥) */
    .chara-small{ position:fixed; bottom:12px; right:12px; width:180px; opacity:0.9; z-index:5; pointer-events:none; display:none; }

    /* ë°˜ì‘í˜•: ëª¨ë°”ì¼ì—ì„œ ì¶•ì†Œ */
    @media(max-width:768px){
      .header-inner{gap:8px;}
      .logos img{height:32px;}
      .mainlogo{height:40px;}
      .bar input{font-size:14px;}
      .btn{font-size:13px; padding:6px 10px;}
      .result-box{padding:14px;}
      .loading img{ width:18px; height:18px; } /* ìŠ¤í”¼ë„ˆ ì¶•ì†Œ */
      .chara-small{ width:70px; bottom:10px; right:8px; } /* ìºë¦­í„° ì¶•ì†Œ */
    }

    /* ë°ìŠ¤í¬í†±ì—ì„œ ë©”ì¸ë¡œê³ ë¥¼ ë” í¬ê²Œ ë³´ì´ê²Œ */
    @media(min-width:1024px){
      .mainlogo{ height:64px; } /* ë³€ê²½: ë°ìŠ¤í¬í†±ì—ì„œ í¬ê²Œ */
    }
  </style>
  </head>
<body>
  <header>
    <div class="header-inner">
      <div class="logos">
        <img src="sungnamlogo.png" class="seongnam" alt="ì„±ë‚¨ì‹œ ë¡œê³ " />
        <img src="mainlogo.jpg" class="mainlogo" alt="ë‚´ ì† ì•ˆì˜ í–‰ì •ë¹„ì„œ ë¡œê³ " />
      </div>

      <div class="search-wrap">
        <div class="bar">
          <input id="q" placeholder="ì˜ˆ) ìˆ˜ì˜ê³„ì•½ì€ ì–¼ë§ˆê¹Œì§€ ê°€ëŠ¥í•´?" />
          <button onclick="reSearch()">ê²€ìƒ‰</button>
        </div>
      </div>

      <div class="actions">
        <button class="btn" onclick="window.open('https://www.law.go.kr/LSW/main.html')">êµ­ê°€ë²•ë ¹ì •ë³´</button>
        <button class="btn" onclick="window.open('https://www.elis.go.kr/main')">ìì¹˜ë²•ê·œì •ë³´</button>
      </div>
    </div>
  </header>

  <main>
    <div class="result-box">
      <div class="demo-buttons">
        <button class="demo-btn" onclick="demo(1)">ì‹œì—°1</button>
        <button class="demo-btn" onclick="demo(2)">ì‹œì—°2</button>
      </div>

      <div class="qline" id="qline"></div>

      <div id="loading" class="loading hidden" aria-live="polite">
        <img src="greenrotate.gif" alt="ë¡œë”© ì¤‘">
        <span>ğŸ”„ ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤â€¦</span>
      </div>

      <div class="answer" id="answer">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê³  â€˜ê²€ìƒ‰â€™ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
    </div>
  </main>

  <img src="greenrotate.gif" class="chara-small" alt="ì´ˆë­ì´" id="floatingChara">

  <script>
    // ğŸ’¡ ì¤‘ìš”: ì´ URLì„ **ë³¸ì¸ì˜ Apps Script ì›¹ì•± URLë¡œ êµì²´**í•´ì•¼ í•©ë‹ˆë‹¤.
    // ê¸°ì¡´ URL ìœ ì§€:
    const ASK_ENDPOINT = 'https://script.google.com/macros/s/AKfycbzd_EABVzt49XDVzgyr0FI3ybwOSGrit77To0kh27RnOTnmBVLT_xgAXYItOZjKq7eT7g/exec';

    const params = new URLSearchParams(location.search);
    const initialQ = params.get('q') || '';
    const $q = document.getElementById('q');
    const $qline = document.getElementById('qline');
    const $answer = document.getElementById('answer');
    const $loading = document.getElementById('loading');
    const $chara = document.getElementById('floatingChara');

    if(initialQ){ $q.value = initialQ; fetchAnswer(initialQ); }

    function reSearch(){
      const val = $q.value.trim();
      if(!val) return;
      // ì„œë¸Œê²½ë¡œì—ì„œ ë™ì‘í•˜ë„ë¡ ìƒëŒ€ê²½ë¡œ ì‚¬ìš©
      history.replaceState(null,'','result.html?q='+encodeURIComponent(val));
      fetchAnswer(val);
    }

    function demo(type){
      const text = (type===1) ? 'ìˆ˜ì˜ê³„ì•½ì€ ì–¼ë§ˆê¹Œì§€ ê°€ëŠ¥í•´?' : 'í˜‘ìƒì— ì˜í•œ ê³„ì•½ ì ˆì°¨ ì•Œë ¤ì¤˜';
      $q.value = text;
      history.replaceState(null,'','result.html?q='+encodeURIComponent(text));
      fetchAnswer(text);
    }

    function setLoading(isLoading){
      if(isLoading){
        $loading.classList.remove('hidden');
        $answer.classList.add('hidden');
        // ìºë¦­í„° í‘œì‹œ(ì„ íƒ): ëª¨ë°”ì¼ì—ì„œëŠ” ìˆ¨ê¹€ CSSê°€ ì ìš©ë¨
        $chara.style.display = 'block';
      }else{
        $loading.classList.add('hidden');
        $answer.classList.remove('hidden');
        $chara.style.display = 'none';
      }
    }

    async function fetchAnswer(q){
      $qline.textContent = `ê²€ìƒ‰ì–´: â€œ${q}â€`;
      setLoading(true);
      try{
        const res = await fetch(ASK_ENDPOINT, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ question: q })
        });
        
        // HTTP ì‘ë‹µì´ ì •ìƒì´ ì•„ë‹ ê²½ìš° (ì˜ˆ: 404, 500 ë“±)
        if(!res.ok){
          throw new Error(`Apps Script ì„œë²„ ì˜¤ë¥˜: HTTP ${res.status}`);
        }
        
        const data = await res.json();
        
        // Apps Scriptì—ì„œ ë°˜í™˜í•œ ì‘ë‹µ ë©”ì‹œì§€ ì²˜ë¦¬
        const answerText = data?.answer || 'ë‹µë³€ì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.';
        
        // ğŸ’¡ ì¤‘ìš”: API í‚¤ ì˜¤ë¥˜ ë©”ì‹œì§€ ë“±ì— ëŒ€í•œ í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê²½ê³ 
        if(answerText.includes('API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.') || answerText.startsWith('ì˜¤ë¥˜:')){
          $answer.style.color = 'red';
          $answer.textContent = 'âŒ ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. Apps Scriptì˜ ë¡œê·¸ì™€ API í‚¤ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”. \n\n' + answerText;
        } else {
          $answer.style.color = '#202124'; // ê¸°ë³¸ ìƒ‰ìƒìœ¼ë¡œ ë³µêµ¬
          $answer.textContent = answerText;
        }
        
      }catch(e){
        console.error(e);
        // ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” íŒŒì‹± ì˜¤ë¥˜ ë°œìƒ ì‹œ
        $answer.style.color = 'red';
        $answer.textContent = `âŒ ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ì½˜ì†” í™•ì¸) \nì—ëŸ¬: ${e.message}`;
      }finally{
        setLoading(false);
      }
    }

    $q.addEventListener('keydown', e => { if(e.key==='Enter') reSearch(); });
  </script>
</body>
</html>
